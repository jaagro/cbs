<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jaagro.cbs.biz.mapper.BatchPlantCoopMapperExt">

    <!--          自动生成扩展XML author: generator on 2019/2/21                 -->
    <select id="listPlantIdByPlanId" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        select id from batch_plant_coop
        where enable = 1
        and plan_id = #{planId}
        group by plant_id
    </select>

    <insert id="insertBatch" parameterType="list">
        insert into batch_plant_coop ( id, plan_id, plant_id, create_user_id,
        modify_time, modify_user_id)
        values
        <foreach collection="batchPlantCoops" item="item" separator=",">
            (#{item.id}, #{item.planId}, #{item.plantId},
            #{item.createUserId}, #{item.modifyTime}, #{item.modifyUserId})
        </foreach>
    </insert>

    <select id="listBreedingPlanCoopsForChoose" resultType="com.jaagro.cbs.api.dto.plan.BreedingPlanCoopDto">
        SELECT
            bpc.plant_id,
            p.plant_name,
            c.breeding_value,
            c.capacity,
            c.home_number,
            c.coop_status,
            c.id,
            c.device_quantity,
            c.last_start_date,
            c.last_end_date
            FROM
            batch_plant_coop bpc
            LEFT JOIN plant p on bpc.plant_id = p.id
            LEFT JOIN coop c ON bpc.plant_id = c.plant_id
            WHERE
            bpc.plant_id = #{planId}
            AND coop_id IS NULL
            AND bpc.`enable` = 1
            AND c.`enable` = 1
            AND c.coop_status = 1
    </select>
    <select id="getPlanIdByCoopId" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        SELECT
            plan_id
        FROM
            batch_plant_coop
        WHERE
            ENABLE = 1
            AND coop_id = #{coopId}
        ORDER BY
            create_time DESC
            LIMIT 1
    </select>
</mapper>